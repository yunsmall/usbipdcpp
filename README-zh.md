# usbipdcpp

ä¸€ä¸ªç”¨äºåˆ›å»º usbip æœåŠ¡å™¨çš„ C++ åº“

## åŠŸèƒ½ç‰¹æ€§

- âœ… **USBIP æœåŠ¡å™¨**: åŸºäº libusb å®ç°ï¼Œæ”¯æŒæ‰€æœ‰ libusb å…¼å®¹å¹³å°
- âœ… **è™šæ‹Ÿ HID è®¾å¤‡**: è·¨å¹³å°è™šæ‹Ÿ USB è®¾å¤‡æ”¯æŒï¼ˆæ— éœ€ libusbï¼‰ï¼Œè¯¦è§ `examples` ç›®å½•
- ğŸš€ **å¼‚æ­¥æ¶æ„**: ä½¿ç”¨ C++20 åç¨‹å’Œ asio å®ç°é«˜æ•ˆ I/O
- ğŸ§© **å¯æ‰©å±•è®¾è®¡**: æä¾›å®Œå–„çš„æŠ½è±¡æ¥å£ä¾›å¼€å‘è€…æ‰©å±•

æ¬¢è¿è´¡çŒ®ä»£ç ï¼ğŸš€

---

## æ¶æ„è®¾è®¡

USB é€šä¿¡å’Œç½‘ç»œé€šä¿¡éƒ½æ˜¯ I/O å¯†é›†å‹ä»»åŠ¡ï¼Œæœ¬é¡¹ç›®é‡‡ç”¨å…¨å¼‚æ­¥æ¶æ„ï¼š
- ä½¿ç”¨ C++20 åç¨‹å¤„ç†ç½‘ç»œé€šä¿¡
- ä½¿ç”¨ libusb å¼‚æ­¥æ¥å£å¤„ç† USB é€šä¿¡

### çº¿ç¨‹æ¨¡å‹
ç³»ç»ŸåŒ…å«ä¸‰ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼š
1. **ç½‘ç»œ I/O çº¿ç¨‹**: è¿è¡Œ `asio::io_context::run()`
2. **USB ä¼ è¾“çº¿ç¨‹**: å¤„ç† `libusb_handle_events()`
3. **å·¥ä½œçº¿ç¨‹æ± **: æ‰§è¡Œè®¾å¤‡é€»è¾‘

æ•°æ®ä¼ è¾“æµç¨‹ï¼š
```
ç½‘ç»œçº¿ç¨‹ â†’ libusb_submit_transfer â†’ USBçº¿ç¨‹ â†’ å›è°ƒ â†’ ç½‘ç»œçº¿ç¨‹
```
è¯¥æ¶æ„é€šè¿‡æœ€å°åŒ–çº¿ç¨‹ç«äº‰å®ç°é«˜ CPU æ•ˆç‡

### è™šæ‹Ÿè®¾å¤‡å®ç°
å¼€å‘è™šæ‹Ÿè®¾å¤‡æ—¶éœ€æ³¨æ„ï¼š
- é¿å…é˜»å¡ç½‘ç»œçº¿ç¨‹
- åœ¨å·¥ä½œçº¿ç¨‹ä¸­å¤„ç†è¯·æ±‚
- é€šè¿‡å›è°ƒæäº¤å“åº”æ•°æ®

---

## ä½¿ç”¨æŒ‡å—

### ä»£ç è¯´æ˜
> ğŸ“ æ³¨é‡Šå’Œæ—¥å¿—ä¸»è¦ä½¿ç”¨ä¸­æ–‡ï¼Œä»£ç ç»“æ„æ¸…æ™°æ˜“è¯»  
> æ¬¢è¿æäº¤è‹±æ–‡ç¿»è¯‘çš„ PRï¼

### æ‰©å±•åŠŸèƒ½
å®ç°è‡ªå®šä¹‰ USB è®¾å¤‡ï¼š
1. ä½¿ç”¨ `usbipdcpp::UsbDevice` å®šä¹‰è®¾å¤‡æè¿°ç¬¦
2. ç»§æ‰¿ `AbstDeviceHandler` å®ç°è®¾å¤‡é€»è¾‘
3. ä½¿ç”¨ `VirtualInterfaceHandler` å¤„ç†æ¥å£æ“ä½œï¼ŒåŒæ—¶å®ç°æ¥å£å†…çš„ç«¯ç‚¹çš„é€»è¾‘

ç®€å•è®¾å¤‡å¯ç›´æ¥ä½¿ç”¨ `SimpleVirtualDeviceHandler`ï¼Œå®ƒä¸ºæ ‡å‡†è¯·æ±‚æä¾›äº†ç©ºå®ç°

---

## âš ï¸ Windows ä½¿ç”¨æç¤º

åœ¨ Windows ä½¿ç”¨ libusb æœåŠ¡å™¨éœ€è¦æ›¿æ¢é©±åŠ¨ï¼š
1. ä½¿ç”¨ [Zadig](https://zadig.akeo.ie/) å®‰è£… WinUSB é©±åŠ¨
    - é€‰æ‹©ç›®æ ‡è®¾å¤‡ï¼ˆæ‰¾ä¸åˆ°è®¾å¤‡æ—¶å¯ç”¨"åˆ—å‡ºæ‰€æœ‰è®¾å¤‡"ï¼‰
    - **è­¦å‘Š**ï¼šæ›¿æ¢é¼ æ ‡/é”®ç›˜é©±åŠ¨ä¼šå¯¼è‡´è¾“å…¥å¤±æ•ˆ
2. ä½¿ç”¨åé€šè¿‡è®¾å¤‡ç®¡ç†å™¨å›æ»šé©±åŠ¨ï¼š
    - `Win+X` â†’ è®¾å¤‡ç®¡ç†å™¨ â†’ é€‰æ‹©è®¾å¤‡ â†’ å›æ»šé©±åŠ¨ç¨‹åº

å¯¹äºç‰©ç†è®¾å¤‡ï¼Œæ¨èä½¿ç”¨ [usbipd-win](https://github.com/dorssel/usbipd-win) ï¼Œ
è¯¥é¡¹ç›®ä½¿ç”¨VBoxUSBä»é©±åŠ¨å±‚é¢å®ç°ä¸Šè¿°åŠŸèƒ½ 
æœ¬é¡¹ç›®æ›´é€‚åˆåœ¨ Windows å®ç°**è™šæ‹Ÿ USB è®¾å¤‡**

---

## ç¼–è¯‘å®‰è£…

```bash
cmake -B build
cmake --build build
cmake --install build
```

---

## ä½¿ç”¨
```cmake
find_package(usbipdcpp CONFIG REQUIRED)
target_link_libraries(main PRIVATE usbipdcpp::usbipdcpp)

# æˆ–è€…æƒ³ä½¿ç”¨libusbåŠŸèƒ½

find_package(usbipdcpp CONFIG REQUIRED COMPONENTS libusb)
target_link_libraries(main PRIVATE usbipdcpp::usbipdcpp usbipdcpp::usbipdcpp_libusb)
```

---

## è‡´è°¢
æœ¬é¡¹ç›®å—ç›Šäºä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š
- [usbipd-libusb](https://github.com/raydudu/usbipd-libusb)
- [usbip](https://github.com/jiegec/usbip)